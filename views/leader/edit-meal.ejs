<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <title><%= meal ? 'تعديل' : 'إضافة' %> وجبة</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .total-box { background: #f8f9fa; padding: 15px; border-radius: 5px; margin: 15px 0; }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h1><%= meal ? 'تعديل' : 'إضافة' %> وجبة</h1>
        
        <form method="POST" class="needs-validation" novalidate>
            <!-- Basic Info -->
            <div class="mb-3">
                <label class="form-label">التاريخ</label>
                <input type="date" name="date" class="form-control" required
                       value="<%= meal ? meal.date.toISOString().split('T')[0] : new Date().toISOString().split('T')[0] %>">
            </div>

            <div class="mb-3">
                <label class="form-label">النوع</label>
                <select name="type" class="form-control" required>
                    <option value="breakfast" <%= meal?.type === 'breakfast' ? 'selected' : '' %>>فطور</option>
                    <option value="lunch" <%= meal?.type === 'lunch' ? 'selected' : '' %>>غداء</option>
                    <option value="dinner" <%= meal?.type === 'dinner' ? 'selected' : '' %>>عشاء</option>
                    <option value="other" <%= meal?.type === 'other' ? 'selected' : '' %>>أخرى</option>
                </select>
            </div>

            <!-- Ingredients -->
            <div class="mb-3">
                <label class="form-label">المكونات</label>
                <div id="ingredientList"></div>
                <button type="button" class="btn btn-secondary" onclick="addIngredient()">إضافة مكون</button>
            </div>

            <!-- Totals -->
            <div class="total-box">
                <h5>ملخص التكلفة</h5>
                <p>التكلفة العادية: $<span id="normalTotal">0.00</span></p>
                <p>التكلفة الأخرى: $<span id="otherTotal">0.00</span></p>
                <p>التكلفة الإجمالية: $<span id="grandTotal">0.00</span></p>
                <p>التكلفة للشخص الواحد: $<span id="perPersonCost">0.00</span></p>
            </div>

            <!-- Participants -->
            <div class="mb-3">
                <label class="form-label">المشاركون</label>
                <div id="participantsList"></div>
                <button type="button" class="btn btn-secondary" onclick="addParticipant()">إضافة مشارك</button>
            </div>

            <button type="submit" class="btn btn-primary">حفظ الوجبة</button>
        </form>
    </div>

    <script>
        // Initialize data before loading meal-form.js
        window.participants = <%- JSON.stringify(participants || []) %>;
        <% if (meal) { %>
        window.existingMeal = <%- JSON.stringify(meal) %>;
        <% } %>
    </script>
    <script src="/public/js/meal-form.js"></script>
</body>
</html>
